# CMS 플랫폼 기획 및 개발 현황

---

## 1. 프로젝트 개요

### 한 줄 요약

**"빈 도화지" 범용 CMS 플랫폼** — 초기 상태에서 아무 구조 없이, 사용자가 목적에 맞게 자유롭게 설계하는 CMS

### 왜 만드는가?

| 목적                 | 설명                                                              |
| -------------------- | ----------------------------------------------------------------- |
| **SI 내부 도구**     | CMS를 기반으로 프로젝트를 빠르게 납품 → 개발 비용 절감, 마진 증가 |
| **사업 수주 어필**   | "자체 CMS 솔루션 보유" → 기업 고객 신뢰 확보                      |
| **SaaS 서비스 제공** | 검증된 제품을 SaaS로 포장하여 반복 수익 창출                      |

\*\* SaaS란?

```markdown
SaaS(Software as a Service, 서비스형 소프트웨어)는 **클라우드 기반으로 운영되는 애플리케이션을 인터넷을 통해 웹 브라우저나 앱으로 이용하는 모델**입니다. 설치나 업데이트 없이 구독 방식으로 언제 어디서나 접속 가능
```

### 핵심 차별점

- **완전한 자유도**: 콘텐츠 타입, 필드, 관계, 페이지 구조를 사용자가 직접 정의
- **에디션 분기**: 단일 코드베이스에서 고객 규모에 맞게 기능 범위 조절
- **Headless + 풀스택**: API만 쓸 수도, 페이지 빌더로 사이트 전체를 만들 수도 있음

---

## 2. 제품 전략 — 에디션 & 로드맵

### 에디션 구조

```
┌─────────────────────────────────────────────────────────────┐
│                      Enterprise                             │
│   승인 워크플로우, SSO, 멀티사이트, 필드 레벨 권한                    │
├─────────────────────────────────────────────────────────────┤
│                       Business                              │
│   User Site + 페이지 빌더 + 템플릿/컴포넌트 시스템                   │
├─────────────────────────────────────────────────────────────┤
│                       Starter                               │
│   CMS API + Admin Panel (Headless CMS)                      │
│   콘텐츠 CRUD, 미디어, 역할/권한, 다국어, 버전관리                    │
└─────────────────────────────────────────────────────────────┘
```

| 에디션         | 구성                          | 대상 고객                       |
| -------------- | ----------------------------- | ------------------------------- |
| **Starter**    | API + Admin Panel             | 개발팀 보유 기업 (Headless CMS) |
| **Business**   | + User Site + Page Builder    | 비개발자도 웹사이트 직접 구축   |
| **Enterprise** | + 워크플로우, SSO, 멀티사이트 | 대기업, 복잡한 조직 구조        |

### 개발 로드맵

```
1단계 (현재)      ->        2단계          ->      3단계
─────────────          ──────────             ────────
Starter/Business       Enterprise            *Professional
핵심 CMS 기능            조직 관리 기능           산업 특화 솔루션
                       워크플로우/SSO          (프랜차이즈, 부동산 등 해당 분야 특화)
```

---

## 3. 프로젝트에서 오는 이점

### 사내 핵심 전략으로 사용

> CMS가 내부 생산성 도구 역할을 한다.
> 매번 처음부터 개발하는 대신, CMS를 기반으로 빠르게 납품하면 개발 비용은 줄고 마진은 높아진다.

### 외부 판매 모델로 사용

**1. 구축비 모델 (SI 모델 / 일회성 매출)**

**작동 방식:**

- 고객이 "관리자 페이지를 만들어주세요"라고 의뢰하면, 이 CMS를 기반으로 구축해주는 것
- **고객 서버(또는 호스팅)에 CMS를 설치**하고, 고객 요구사항에 맞게 콘텐츠 타입/페이지/디자인을 세팅해서 납품
- 납품 후 고객이 Admin Panel에서 직접 콘텐츠를 관리
- 쉽게 말하면: **"빈 도화지 CMS"를 고객 맞춤으로 세팅해서 넘겨주는 외주 개발**

**이게 가능한 이유:** 이 CMS가 "빈 도화지" 컨셉이라 어떤 업종이든 빠르게 구축할 수 있음. 매번 처음부터 개발하는 게 아니라, 이미 만들어진 CMS 위에 세팅만 하면 되니까 SI 작업 시간이 크게 단축됨.

---

**2. 구독료 모델 (SaaS 모델 / 반복 매출)**

**작동 방식:**

- **우리 서버(클라우드)에 CMS를 운영**하고, 고객에게 계정을 발급
- 고객은 별도 설치 없이 웹 브라우저로 접속해서 사용 (카페24, Wix처럼)
- 고객 도메인을 연결해주면, 사용자 페이지가 해당 도메인으로 노출
- 에디션별로 기능 범위가 다르므로 **요금제 차등 적용**

**이게 가능한 이유:** 환경변수 `CMS_EDITION` 하나로 기능 범위를 조절하는 단일 코드베이스 구조. 하나의 시스템으로 여러 등급의 서비스를 제공할 수 있음.

---

**3. 두 모델의 비교**

|               | 구축비 (SI)    | 구독료 (SaaS)   |
| ------------- | -------------- | --------------- |
| **매출 형태** | 일회성 큰 금액 | 월/연 반복 소액 |
| **서버 관리** | 고객이 관리    | 우리가 관리     |
| **설치 위치** | 고객 서버      | 우리 서버       |
| **고객 접점** | 프로젝트 단위  | 지속적 관계     |

---

**4.정리**

1. SI 사업에서 이 CMS를 "**무기**"로 활용 → 구축비로 수주하면서 개발비 회수
2. **수익 구조**

   | 항목        | 설명                                   |
   | ----------- | -------------------------------------- |
   | 구축비      | 초기 설치 + 커스터마이징 비용 (일회성) |
   | 유지보수비  | 월/연 단위 유지보수 계약 (선택)        |
   | 추가 개발비 | 기능 추가/변경 요청 시 별도            |

3. **판매 대상 예시**:

   | 에디션              | 대상                                     | 제공 기능                        |
   | ------------------- | ---------------------------------------- | -------------------------------- |
   | **Starter**         | 개발팀 있는 기업                         | API + Admin Panel (Headless)     |
   | **Business**        | 개발자없이 페이지 구성필요한 기업        | + 사용자 페이지 + 페이지 빌더    |
   | **Enterprise**      | CMS와 함께 사내 업무관리툴이 필요한 기업 | + 워크플로우, SSO, 멀티사이트 등 |
   | **Professional**    | 별도의 전문성이 필요한 CMS가 필요한 기업 | + 고객사의 필요에 의한 기능      |
   | ( 전문성이 필요함 ) |

---

## 4. 플랫폼 구조

### 전체 구성

```
┌──────────────────────────────────────────────┐
│              Admin Panel (관리자)            │
│  콘텐츠 관리, 페이지 빌더, 회원/역할, 미디어         │
│  SEO, 알림, 백업, Import/Export               │
└─────────────────────┬────────────────────────┘
                      │ REST / GraphQL API
┌─────────────────────┴────────────────────────┐
│              NestJS Backend (서버)            │
│  인증, 콘텐츠 CRUD, 미디어, 역할/권한               │
│  이미지 처리, 검색, 예약 발행                      │
│  PostgreSQL + Prisma ORM                     │
└─────────────────────┬────────────────────────┘
                      │
┌─────────────────────┴────────────────────────┐
│           User Site (사용자 웹사이트)            │
│      [Business+] 페이지 빌더로 구축              │
│      또는 API로 자체 프론트 구축 (Headless)       │
└──────────────────────────────────────────────┘

```

### Admin Panel 메뉴 구조

```
Admin Panel
├── 대시보드                           ← 전체 현황
├── 콘텐츠 관리
│   ├── 콘텐츠 타입 정의              ← "게시글", "상품" 등 스키마 생성
│   └── 콘텐츠 목록/CRUD              ← 실제 데이터 입력
├── 페이지 관리 [Business]
│   ├── 메인/일반/동적/시스템 페이지
│   └── 공통 레이아웃 (헤더/푸터)
├── 템플릿/컴포넌트 관리 [Business]
├── 미디어 관리                        ← 이미지/파일, 폴더, 썸네일
├── 회원 관리
├── 관리자 관리 (역할/권한)
├── SEO 설정
├── 알림 센터
├── 로그/감사, 백업/복원, Import/Export, 휴지통
├── 워크플로우 [Enterprise]            ← 초안→검토→승인→발행
├── 내부 댓글 [Enterprise]
└── 시스템 설정 (사이트 정보, 다국어, Webhook)

```

### 핵심 기능 목록 (Phase A)

| 기능                    | 설명                                               | 에디션       |
| ----------------------- | -------------------------------------------------- | ------------ |
| 콘텐츠 타입/콘텐츠 CRUD | 사용자 정의 스키마로 동적 콘텐츠 관리              | Starter      |
| 미디어 관리             | 파일 업로드, 폴더 정리, 이미지 최적화              | Starter      |
| 역할/권한               | Role 기반 세밀한 권한 관리                         | Starter      |
| 다국어 (i18n)           | 콘텐츠 다국어 버전 관리                            | Starter      |
| 버전 관리               | 수정 이력 저장, 롤백                               | Starter      |
| 예약 발행               | 특정 시간 자동 발행/종료                           | Starter      |
| API 자동 생성           | 콘텐츠 타입별 REST API 자동 생성 + Swagger         | Starter      |
| SEO 관리                | 메타태그, OG, sitemap, 슬러그                      | Starter      |
| 검색                    | 전문 검색 엔진 기반 콘텐츠 검색                    | Starter      |
| 이미지 최적화           | 자동 리사이즈, WebP 변환, 썸네일                   | Starter      |
| 알림 센터               | 콘텐츠별 알림 대상 설정, 이메일                    | Starter      |
| 로그/Webhook            | 감사 로그, 외부 서비스 연동                        | Starter      |
| 백업/복원               | 자동/수동 백업, 시점 복원                          | Starter      |
| Import/Export           | CSV/JSON 대량 가져오기/내보내기                    | Starter      |
| 휴지통                  | 소프트 삭제, 복원, 자동 비우기                     | Starter      |
| 페이지 빌더             | 드래그앤드롭 페이지 구축                           | Business     |
| 실시간 미리보기         | 편집 중 실시간 확인                                | Business     |
| 템플릿/컴포넌트         | 재사용 가능한 블록 시스템                          | Business     |
| 승인 워크플로우         | 초안→검토→승인→발행 단계별 콘텐츠 승인 프로세스    | Enterprise   |
| SSO                     | SAML/OAuth 기반 기업 통합 인증 (사내 계정 연동)    | Enterprise   |
| 멀티사이트              | 하나의 설치로 여러 사이트 운영, 사이트별 독립 설정 | Enterprise   |
| 필드 레벨 권한          | 필드 단위 읽기/쓰기 권한 제어 (민감 데이터 보호)   | Enterprise   |
| \*기타 고객의 추가요구  | 고객 맞춤형 추가기능개발 제공                      | Professional |

---

## 5. 기술 스택

### 핵심 기술

| 영역             | 기술                        | 선정 이유                                |
| ---------------- | --------------------------- | ---------------------------------------- |
| **백엔드**       | NestJS (TypeScript)         | 모듈화 구조, 엔터프라이즈급, 넓은 생태계 |
| **프론트엔드**   | React 19 (JavaScript)       | 최대 생태계, React Compiler 자동 최적화  |
| **데이터베이스** | PostgreSQL                  | JSONB 지원, 안정성, 확장성               |
| **ORM**          | Prisma 7.x                  | 타입 안전, 마이그레이션 자동화           |
| **UI**           | Tailwind CSS v4 + Shadcn/ui | 빠른 UI 개발, 코드 소유                  |

### 오픈소스 라이브러리 전략

Strapi 같은 완성형 CMS를 가져오는 것이 아니라, **검증된 라이브러리를 레고 블록처럼 조합**하여 개발 시간을 단축한다. 현재 아키텍처(NestJS + React)를 유지하면서 개별 기능 단위로 통합.

### 핵심 라이브러리

| 라이브러리      | 용도               | 라이선스   | 왜 필요한가                                                                  |
| --------------- | ------------------ | ---------- | ---------------------------------------------------------------------------- |
| **Craft.js**    | 페이지 빌더 엔진   | MIT        | 직접 구현 시 가장 오래 걸리는 기능. React 네이티브 통합                      |
| **TipTap**      | 리치 텍스트 에디터 | MIT        | 콘텐츠 작성 필수. ProseMirror 기반, 확장성 우수                              |
| **MeiliSearch** | 검색 엔진          | MIT        | 빠르고 가벼움, 한국어 지원. **인터페이스 패턴으로 추후 자체 엔진 교체 가능** |
| **Sharp**       | 이미지 처리        | Apache-2.0 | Node.js 표준, ImageMagick 대비 4~5배 빠름                                    |

### 보조 라이브러리 (백엔드)

| 라이브러리               | 용도                                             |
| ------------------------ | ------------------------------------------------ |
| **BullMQ**               | 비동기 작업 큐 (이미지 처리, 예약 발행, Webhook) |
| **@nestjs/schedule**     | 크론 작업 (예약 발행 체크, 자동 정리)            |
| **@nestjs/throttler**    | API Rate Limiting (남용 방지)                    |
| **isomorphic-dompurify** | HTML XSS 방지 (보안 필수)                        |
| **Nodemailer**           | 이메일 발송                                      |
| **SheetJS**              | CSV/Excel 처리                                   |

### 보조 라이브러리 (프론트엔드)

| 라이브러리                | 용도                             |
| ------------------------- | -------------------------------- |
| **@tanstack/react-table** | 데이터 테이블 (모든 목록 페이지) |
| **date-fns**              | 날짜 포매팅 (한국어 지원)        |
| **@dnd-kit**              | 드래그앤드롭 (페이지 빌더)       |

### 모든 라이브러리는 MIT 또는 Apache-2.0 — 상업적 제약 없음

---

## 6. 현재 개발 진행 상황

### 백엔드 — Starter 핵심 모듈 구현 완료

#### 모듈별 API 상세

| 모듈            | API 수     | 주요 기능                                   | 상태 |
| --------------- | ---------- | ------------------------------------------- | ---- |
| **Auth**        | 5개        | 회원가입, 로그인, 로그아웃, JWT 갱신, 프로필 조회 | ✅ 완료 |
| **Role**        | 5개        | 역할 CRUD (생성/목록/상세/수정/삭제)        | ✅ 완료 |
| **UserRole**    | 7개        | 역할 요청/승인/거절, 사용자 역할 조회/제거  | ✅ 완료 |
| **ContentType** | 5개        | 동적 콘텐츠 타입 정의 CRUD                  | ✅ 완료 |
| **Content**     | 10개       | CRUD, 발행/비발행, 버전 관리, 복원, 슬러그 조회 | ✅ 완료 |
| **Media**       | 7개        | 단일/다중 업로드, 목록/상세/수정, 소프트/하드 삭제 | ✅ 완료 |
| **MediaFolder** | 5개        | 폴더 CRUD, 계층 구조 관리                   | ✅ 완료 |
| **Tasks**       | 크론 3개   | 예약 발행, 휴지통 정리, 임시파일 정리       | ✅ 완료 |
| **합계**        | **API 44개 + 크론 3개** |                                | |

#### 백엔드 API 엔드포인트 상세

**Auth (5개)**
```
POST   /auth/register          회원가입 (ADMIN/MEMBER 타입 지정)
POST   /auth/login             로그인 (Rate Limit: 5회/분)
POST   /auth/logout            로그아웃 (Refresh Token 무효화)
POST   /auth/refresh           토큰 갱신 (토큰 로테이션 적용)
GET    /auth/me                현재 사용자 프로필 조회
```

**Role (5개) + UserRole (7개)**
```
POST   /roles                          역할 생성 (권한 배열 포함)
GET    /roles                          역할 목록 (활성 사용자 수 포함)
GET    /roles/:id                      역할 상세 (ID 또는 slug)
PATCH  /roles/:id                      역할 수정
DELETE /roles/:id                      역할 삭제 (활성 사용자 없을 때만)

POST   /user-roles/request             역할 요청
GET    /user-roles/requests/pending    대기 중인 요청 목록 (관리자)
GET    /user-roles/my-requests         내 요청 목록
GET    /user-roles/my-roles            내 활성 역할 목록
POST   /user-roles/requests/:id/approve  역할 요청 승인 (관리자)
POST   /user-roles/requests/:id/reject   역할 요청 거절 (관리자)
DELETE /user-roles/users/:userId/roles/:roleId  사용자 역할 제거 (관리자)
```

**ContentType (5개)**
```
POST   /content-types                  콘텐츠 타입 생성 (필드 정의 포함)
GET    /content-types                  콘텐츠 타입 목록
GET    /content-types/:id              콘텐츠 타입 상세 (ID 또는 slug)
PATCH  /content-types/:id              콘텐츠 타입 수정
DELETE /content-types/:id              콘텐츠 타입 삭제 (사용 중인 콘텐츠 없을 때만)
```

**Content (10개)**
```
POST   /contents                       콘텐츠 생성
GET    /contents                       콘텐츠 목록 (타입/상태/검색/페이지네이션 필터)
GET    /contents/:id                   콘텐츠 상세
GET    /contents/:contentTypeId/slug/:slug  슬러그로 콘텐츠 조회
PATCH  /contents/:id                   콘텐츠 수정 (자동 버전 생성)
DELETE /contents/:id                   콘텐츠 소프트 삭제
POST   /contents/:id/publish           콘텐츠 발행
POST   /contents/:id/unpublish         콘텐츠 발행 취소
GET    /contents/:id/versions          버전 이력 조회
POST   /contents/:id/versions/:version/restore  특정 버전으로 복원
```

**Media (7개) + MediaFolder (5개)**
```
POST   /media/upload                   단일 파일 업로드
POST   /media/upload/multiple          다중 파일 업로드 (최대 10개)
GET    /media                          미디어 목록 (폴더/타입/검색/페이지네이션 필터)
GET    /media/:id                      미디어 상세
PATCH  /media/:id                      미디어 메타데이터 수정 (alt, caption, 폴더)
DELETE /media/:id                      미디어 소프트 삭제
DELETE /media/:id/hard                 미디어 하드 삭제 (파일 물리 삭제)

POST   /media/folders                  폴더 생성
GET    /media/folders                  폴더 목록 (계층 구조)
GET    /media/folders/:id              폴더 상세
PATCH  /media/folders/:id              폴더 수정
DELETE /media/folders/:id              폴더 삭제 (비어있을 때만)
```

#### 백엔드 인프라 및 공통 기능

| 항목                     | 구현 내용                                                   |
| ------------------------ | ----------------------------------------------------------- |
| **API 문서**             | Swagger 자동 생성 (`/api-docs`), 8개 태그 분류              |
| **인증**                 | JWT (Access 1h + Refresh 7d), bcrypt 해싱, 토큰 로테이션    |
| **권한**                 | `resource:action` 형식, 와일드카드(`*`) 지원, OR 로직       |
| **가드**                 | JwtAuthGuard (토큰 검증), PermissionsGuard (권한 확인)      |
| **예외 처리**            | AllExceptionsFilter (전역), 표준화된 에러 응답 포맷         |
| **유효성 검사**          | ValidationPipe (whitelist, transform), DTO 17개             |
| **Rate Limiting**        | 전역 300회/분, 로그인 5회/분 (@nestjs/throttler)            |
| **이미지 처리**          | Sharp — 썸네일(sm/md/lg), WebP 변환, 크기 추출             |
| **예약 발행**            | 매분 크론으로 scheduledAt 체크 후 자동 발행                 |
| **자동 정리**            | 소프트 삭제 30일 후 자동 영구삭제, 임시파일 24시간 후 정리  |
| **XSS 방지**             | isomorphic-dompurify — richtext 필드 HTML 소독              |
| **CORS**                 | Admin(5173) + Public(5174) 다중 출처 지원                   |

#### 데이터베이스 스키마 (Prisma 모델 15개)

```
┌─ 사용자/권한 ──────────────────────────────┐
│  User          사용자 (email, password, type:ADMIN|MEMBER)
│  Role          역할 (name, slug, permissions:JSON)
│  UserRole      사용자-역할 매핑 (status:PENDING|ACTIVE|REJECTED)
│  RefreshToken  세션 관리 (해싱된 토큰, 만료일)
├─ 콘텐츠 관리 ──────────────────────────────┤
│  ContentType   콘텐츠 타입 정의 (fields:JSON, options:JSON)
│  Content       콘텐츠 (data:JSONB, status, version, deletedAt)
│  ContentVersion  버전 이력 (data:JSON, version)
│  Page          페이지 빌더 (components:JSON, settings:JSON)
├─ 미디어 관리 ──────────────────────────────┤
│  Media         파일 (path, thumbnails:JSON, width, height, deletedAt)
│  MediaFolder   폴더 (parentId 자기참조 — 계층 구조)
├─ 워크플로우/협업 ──────────────────────────┤
│  WorkflowAction  콘텐츠 승인 이력 (SUBMIT|APPROVE|REJECT|PUBLISH)
│  Comment       내부 코멘트
│  Notification  알림 (type, title, message, isRead)
├─ 시스템 ───────────────────────────────────┤
│  AuditLog      감사 로그 (action, entity, oldData, newData, IP)
│  Webhook       외부 연동 (url, events:JSON, secret)
└────────────────────────────────────────────┘
```

---

### 프론트엔드 — 기반 완성 + 콘텐츠 타입 관리 구현 완료

#### Provider 시스템 (앱 전체 상태 관리)

```
QueryClientProvider (TanStack Query — 서버 상태 캐싱)
  └─ BrowserRouter (React Router v7 — 라우팅)
      └─ PopupProvider (로딩 스피너, 모달 관리)
          └─ APIProvider (Axios 인스턴스, 인터셉터)
              └─ UserProvider (인증 상태: user, accessToken, refreshToken)
                  └─ GlobalProvider (전역 데이터: contentTypes, isMobile, sidebarOpen)
                      └─ App
```

| Provider        | 핵심 역할                                                          |
| --------------- | ------------------------------------------------------------------ |
| **APIProvider** | Axios 인스턴스, 토큰 자동 부착, 401 자동 갱신/재시도, 로딩 스피너 |
| **UserProvider** | 로그인/로그아웃/토큰갱신, accessToken 메모리 보관 (XSS 방어)     |
| **GlobalProvider** | 콘텐츠 타입 목록 캐싱, 모바일 감지(768px), 사이드바 상태        |
| **PopupProvider** | 전역 모달/팝업, 로딩 프로그레스, 브라우저 뒤로가기 시 자동 닫기 |

#### 라우트 및 페이지 구현 현황

```
/ (AdminLayout — AuthGuard 보호)
├── /                            Dashboard           ⬜ 플레이스홀더
├── /login                       로그인              ✅ 완료
├── /content-types               콘텐츠 타입 목록    ✅ 완료
│   ├── /new                     콘텐츠 타입 생성    ✅ 완료
│   └── /:id/edit                콘텐츠 타입 수정    ✅ 완료
├── /contents/:contentTypeSlug   콘텐츠 목록         ⬜ 플레이스홀더
├── /media                       미디어 관리         ⬜ 플레이스홀더
└── /roles                       역할/권한 관리      ⬜ 플레이스홀더
```

#### 페이지별 기능 구현 현황

| 페이지         | 목록 | 생성 | 수정 | 삭제 | 검색 | 필터 | 페이지네이션 |
| -------------- | ---- | ---- | ---- | ---- | ---- | ---- | ------------ |
| **콘텐츠 타입** | ✅   | ✅   | ✅   | ✅   | —    | —    | —            |
| **콘텐츠**     | ⬜   | ⬜   | ⬜   | ⬜   | ⬜   | ⬜   | ⬜           |
| **미디어**     | ⬜   | ⬜   | ⬜   | ⬜   | ⬜   | ⬜   | ⬜           |
| **역할/권한**  | ⬜   | ⬜   | ⬜   | ⬜   | ⬜   | ⬜   | ⬜           |
| **대시보드**   | ⬜   | —    | —    | —    | —    | —    | —            |

✅ 완료 | ⬜ 미구현

#### 레이아웃 시스템

```
AdminLayout (flex column)
├── AppHeader (고정 상단)
│   ├── 동적 Breadcrumb (경로 기반 자동 생성, 콘텐츠 타입 slug→이름 변환)
│   └── 햄버거 메뉴 (모바일 전용)
└── AdminMain (flex row)
    ├── AppSidebar (좌측 240px)
    │   ├── 고정 메뉴: 대시보드, 콘텐츠 타입, 미디어, 역할/권한
    │   ├── 동적 메뉴: "콘텐츠" 그룹 — GlobalContext에서 콘텐츠 타입 목록 렌더링
    │   └── 로그아웃 버튼 (하단)
    └── AdminContent (메인 컨텐츠 영역)
        └── <Outlet /> (페이지 라우트)
```

- **데스크톱**: 사이드바 좌측 고정 + 콘텐츠 영역 나란히
- **모바일** (< 768px): 사이드바 우측 오버레이 드로어, 햄버거로 토글

#### 공통 컴포넌트

| 컴포넌트          | 용도                                                                        |
| ----------------- | --------------------------------------------------------------------------- |
| **DataTable**     | @tanstack/react-table 래퍼 — colWidths(너비/정렬), 로딩 스켈레톤, 빈 상태 |
| **DeleteDialog**  | 삭제 확인 다이얼로그 — AlertDialog 기반                                    |
| **AuthGuard**     | 인증 가드 — 미인증 시 /login 리다이렉트 (from 상태 보존)                  |
| **Shadcn/ui 25개** | Button, Input, Select, Dialog, Sheet, Sidebar, Table, Form 등              |

#### 프론트엔드 기술 스택 상세

| 라이브러리              | 버전    | 용도                                    |
| ----------------------- | ------- | --------------------------------------- |
| React                   | 19.x    | UI 프레임워크 (React Compiler 적용)     |
| React Router            | v7      | 클라이언트 라우팅                       |
| @tanstack/react-query   | v5      | 서버 상태 관리 (캐싱, 뮤테이션)         |
| @tanstack/react-table   | v8      | 테이블 (Headless)                       |
| react-hook-form + Zod   | v7 + v4 | 폼 관리 + 유효성 검사                   |
| Axios                   | v1      | HTTP 클라이언트                         |
| Tailwind CSS            | v4      | 유틸리티 CSS                            |
| Shadcn/ui (Radix UI)    | —       | UI 컴포넌트 라이브러리 (25개 설치)      |
| date-fns                | v4      | 날짜 포매팅 (한국어)                    |
| Lucide React            | —       | 아이콘                                  |
| Vite                    | v7      | 빌드 도구                               |

---

### 다음 단계

1. ~~**백엔드 라이브러리 통합**: Sharp, @nestjs/throttler, @nestjs/schedule~~ ✅ 완료
2. ~~**콘텐츠 타입 관리 UI**: 목록/생성/수정/삭제 완전 구현~~ ✅ 완료
3. **콘텐츠 관리 UI**: 동적 폼 + TipTap 리치텍스트 에디터
4. **미디어 관리 UI**: 업로드, 폴더 관리, 이미지 미리보기
5. **역할/권한 관리 UI**: 역할 CRUD, 권한 설정, 역할 요청/승인
6. **대시보드**: 전체 현황 통계 (콘텐츠/미디어/사용자 수 등)

---

## 7. 아키텍처 다이어그램

### 시스템 전체 구조

```
┌──────────────────────────────────────────────────────────────────┐
│                        Admin Panel (React 19)                    │
│  Vite + Tailwind v4 + Shadcn/ui + React Router v7               │
│                                                                  │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────────┐     │
│  │ API      │  │ User     │  │ Global   │  │ Popup        │     │
│  │ Provider │  │ Provider │  │ Provider │  │ Provider     │     │
│  │ (Axios)  │  │ (Auth)   │  │ (Cache)  │  │ (Loading/Modal)│   │
│  └────┬─────┘  └──────────┘  └──────────┘  └──────────────┘     │
│       │                                                          │
│  ┌────┴─────────────────────────────────────────────────────┐    │
│  │ Pages                                                     │    │
│  │ Login | Dashboard | ContentType | Content | Media | Role  │    │
│  └───────────────────────────────────────────────────────────┘    │
└──────────────────────────┬───────────────────────────────────────┘
                           │ HTTP (Axios)
                           │ Authorization: Bearer <JWT>
┌──────────────────────────┴───────────────────────────────────────┐
│                     NestJS Backend (TypeScript)                   │
│                                                                   │
│  ┌─── Guards ──────────────────────────────────────────────────┐ │
│  │ JwtAuthGuard → PermissionsGuard → ThrottlerGuard            │ │
│  └─────────────────────────────────────────────────────────────┘ │
│                                                                   │
│  ┌─── Modules ─────────────────────────────────────────────────┐ │
│  │ Auth(5)  Role(5)  UserRole(7)  ContentType(5)               │ │
│  │ Content(10)  Media(7)  MediaFolder(5)  Tasks(cron 3)        │ │
│  └─────────────────────────────────────────────────────────────┘ │
│                                                                   │
│  ┌─── Common ──────────────────────────────────────────────────┐ │
│  │ AllExceptionsFilter | ValidationPipe | DOMPurify(XSS)       │ │
│  │ Sharp(이미지) | @nestjs/schedule(크론) | @nestjs/throttler   │ │
│  └─────────────────────────────────────────────────────────────┘ │
│                                                                   │
│  Swagger API 문서: /api-docs (8개 태그, 44개 엔드포인트)         │
└───────────┬───────────────────────────┬──────────────────────────┘
            │                           │
     ┌──────┴──────┐            ┌───────┴──────┐
     │ PostgreSQL  │            │    Redis     │
     │ (Prisma 7)  │            │  (BullMQ)    │
     │ 15개 모델   │            │  작업 큐     │
     │ JSONB 기반  │            │  (예정)      │
     └─────────────┘            └──────────────┘
```

### 인증 시스템

```
[로그인 흐름]

  브라우저                         서버
    │                               │
    │  POST /auth/login             │
    │  { email, password }          │
    │ ─────────────────────────────>│
    │                               │  bcrypt 비밀번호 검증
    │                               │  Access Token 생성 (1h)
    │                               │  Refresh Token 생성 (7d, DB 해싱 저장)
    │  { accessToken, refreshToken, │
    │    user }                     │
    │ <─────────────────────────────│
    │                               │
    │  accessToken → 메모리 저장    │  (XSS 방어: localStorage에 저장 안 함)
    │  refreshToken → localStorage  │  (앱 재시작 시 자동 갱신 용도)
    │  user → localStorage          │
    │                               │

[요청 흐름]

  브라우저                         서버
    │                               │
    │  API 요청                     │
    │  Authorization: Bearer <AT>   │
    │ ─────────────────────────────>│
    │                               │  JwtAuthGuard: 토큰 검증
    │                               │  PermissionsGuard: 권한 확인
    │                               │  ThrottlerGuard: Rate Limit 확인
    │  200 OK / 데이터              │
    │ <─────────────────────────────│
    │                               │

[토큰 갱신 흐름 — Axios 인터셉터 자동 처리]

  브라우저                         서버
    │                               │
    │  API 요청 → 401 Unauthorized  │  (Access Token 만료)
    │ <─────────────────────────────│
    │                               │
    │  POST /auth/refresh           │
    │  { refreshToken }             │
    │ ─────────────────────────────>│
    │                               │  기존 Refresh Token 무효화 (로테이션)
    │                               │  새 Access + Refresh Token 발급
    │  { newAccessToken,            │
    │    newRefreshToken }          │
    │ <─────────────────────────────│
    │                               │
    │  원래 API 요청 자동 재시도    │
    │ ─────────────────────────────>│
    │                               │
```

### 권한 시스템

```
[데이터 구조]

  User (사용자)
    │
    │  UserRole (N:M 매핑 — 승인 워크플로우 포함)
    │  ├── status: PENDING → ACTIVE (승인 시)
    │  ├── status: PENDING → REJECTED (거절 시)
    │  ├── requestedAt, approvedAt, approvedBy
    │  └── rejectedAt, rejectedBy
    │
    └── Role (역할)
         ├── name: "편집자"
         ├── slug: "editor" (고유)
         └── permissions: ["content:create", "content:update", "media:create", "media:read"]

[권한 형식]

  resource:action
  ├── content:create     콘텐츠 생성
  ├── content:read       콘텐츠 읽기
  ├── content:update     콘텐츠 수정
  ├── content:delete     콘텐츠 삭제
  ├── content:publish    콘텐츠 발행
  ├── media:*            미디어 모든 동작
  ├── role:assign        역할 부여
  └── *                  슈퍼관리자 (모든 권한)

  지원 리소스: auth, role, user, content, content-type, media, task

[권한 검사 흐름]

  @Permissions('content:create')          ← 컨트롤러 데코레이터
  @UseGuards(JwtAuthGuard, PermissionsGuard)
                     │
                     ▼
  PermissionsGuard.canActivate()
    │
    ├── 사용자의 모든 역할 조회 (ACTIVE 상태만)
    ├── 각 역할의 permissions 배열 수집
    ├── 와일드카드 확인: "*" 보유 시 → 허용
    ├── 리소스 와일드카드 확인: "content:*" 보유 시 → content:create 허용
    └── 정확히 일치하는 권한 확인 (OR 로직: 하나라도 매치 시 허용)

[역할 요청/승인 워크플로우]

  일반 사용자                   관리자
    │                             │
    │  POST /user-roles/request   │
    │  { roleId }                 │
    │ ─────────────>  UserRole 생성 (status: PENDING)
    │                             │
    │              GET /user-roles/requests/pending
    │                             │  대기 중인 요청 목록 확인
    │                             │
    │              POST /user-roles/requests/:id/approve
    │                             │  status → ACTIVE, approvedBy 기록
    │                             │
    │  이제 해당 역할의 권한 사용 가능
    │                             │
```

### 콘텐츠 시스템

```
[데이터 구조 — JSONB 하이브리드 방식]

  ContentType (콘텐츠 타입 정의)
  │
  │  name: "블로그 포스트"
  │  slug: "blog-post" (URL 라우팅용, 고유)
  │  description: "블로그 게시글 콘텐츠"
  │  fields: [                              ← JSON 필드 정의
  │    { name: "title",     type: "text",      required: true },
  │    { name: "content",   type: "richtext",  required: false },
  │    { name: "thumbnail", type: "image",     required: false },
  │    { name: "category",  type: "relation",  required: false }
  │  ]
  │  options: { ... }                        ← 추가 설정 (JSON)
  │
  └── Content (콘텐츠 인스턴스 — 동적 데이터)
      │
      │  contentTypeId: FK → ContentType
      │  title: "첫 번째 블로그 글"
      │  slug: "first-blog-post"
      │  data: {                             ← JSONB 동적 데이터
      │    "title": "첫 번째 블로그 글",
      │    "content": "<p>본문 내용...</p>",  (XSS 소독 적용)
      │    "thumbnail": { mediaId: "..." },
      │    "category": { contentId: "..." }
      │  }
      │  status: DRAFT | REVIEW | APPROVED | PUBLISHED | REJECTED | ARCHIVED
      │  version: 1 (수정할 때마다 자동 증가)
      │  scheduledAt: "2026-03-01T09:00:00Z"  ← 예약 발행 (크론이 체크)
      │  deletedAt: null | "2026-02-01..."     ← 소프트 삭제 (30일 후 자동 영구삭제)
      │  createdById, updatedById: FK → User
      │
      └── ContentVersion (버전 이력)
          │
          │  contentId: FK → Content
          │  data: { ... }          ← 해당 시점의 전체 데이터 스냅샷
          │  version: 1, 2, 3 ...
          │  createdAt: 타임스탬프
          │
          └── POST /contents/:id/versions/:version/restore 로 복원 가능

[콘텐츠 상태 흐름]

  DRAFT ──────> REVIEW ──────> APPROVED ──────> PUBLISHED
    │              │               │                │
    │              └── REJECTED    │                └── ARCHIVED
    │                              │
    └──────────────────────────────┘
                (직접 발행 가능)

  * Starter: DRAFT → PUBLISHED (단순 발행)
  * Enterprise: DRAFT → REVIEW → APPROVED → PUBLISHED (승인 워크플로우)

[JSONB 방식을 선택한 이유]

  ❌ 동적 테이블 방식: 콘텐츠 타입마다 DB 테이블 생성 → 마이그레이션 복잡, 관리 어려움
  ❌ EAV 방식: Entity-Attribute-Value → 쿼리 복잡, 성능 저하
  ✅ JSONB 방식: 하나의 contents 테이블에 data 컬럼으로 유연하게 저장
     → 필드 추가/삭제 시 스키마 변경 불필요
     → PostgreSQL JSONB 인덱싱으로 쿼리 성능 확보
     → 버전 관리 간편 (JSON 스냅샷 저장)

[미디어 시스템]

  파일 업로드 → 유효성 검사 → 원본 저장
                                 │
                    ┌────────────┼────────────┐
                    │            │            │
              원본 저장    썸네일 생성     WebP 변환
              uploads/     (Sharp)        (Sharp)
              images/     sm: 150px     images/webp/
              original/   md: 300px
                          lg: 600px
                                 │
                          DB 저장 (Media 모델)
                          - path, url, thumbnails:JSON
                          - width, height, mimeType, size

  uploads/
  ├── images/
  │   ├── original/     원본 이미지
  │   ├── thumbnails/
  │   │   ├── sm/       150px
  │   │   ├── md/       300px
  │   │   └── lg/       600px
  │   └── webp/         WebP 변환
  ├── files/            이미지 외 파일
  └── temp/             임시 파일 (24시간 후 자동 삭제)
```

---

## 8. 경쟁 분석 및 포지셔닝

### 왜 Strapi를 안 쓰는가?

| 구분        | Strapi 사용                    | 자체 개발              |
| ----------- | ------------------------------ | ---------------------- |
| 제어권      | Strapi 프레임워크에 종속       | 완전한 코드 소유권     |
| 커스텀      | 제한적                         | 무제한                 |
| 라이선스    | SEE License (상업적 제약 가능) | MIT/Apache (제약 없음) |
| 기존 코드   | NestJS 백엔드 전부 버려야 함   | 현재 코드 100% 활용    |
| 페이지 빌더 | 없음                           | Craft.js로 직접 구현   |

**결론**: Strapi 같은 완성형 CMS를 통째로 가져오는 것이 아니라, 검증된 오픈소스 라이브러리를 개별적으로 통합하여 자체 CMS를 구축한다.

---

## 9. 핵심 정리

| 항목          | 내용                                                                             |
| ------------- | -------------------------------------------------------------------------------- |
| **제품**      | 에디션 기반(Starter/Business/Enterprise) "빈 도화지" 범용 CMS 플랫폼             |
| **기술**      | NestJS + React 19 + PostgreSQL + Prisma, 검증된 오픈소스 라이브러리 조합 전략    |
| **수익**      | SI 구축비(일회성) + SaaS 구독료(반복) 이중 수익 모델                             |
| **현재 상태** | 백엔드 API 44개+크론3개 완료, 프론트엔드 기반+콘텐츠 타입 CRUD 완료, 콘텐츠/미디어/역할 UI 구현 중 |
| **차별점**    | 완전한 자유도의 "빈 도화지" 컨셉 + 코드 소유권 100% + Headless & 풀스택 겸용     |
